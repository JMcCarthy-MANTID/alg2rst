This algorithm is only used for testing.
